<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Event Cards</title>
    <!-- <style>
        .card {
            border: 1px solid #ccc;
            padding: 16px;
            margin: 8px;
            border-radius: 8px;
            box-shadow: 2px 2px 8px rgba(0, 0, 0, 0.1);
        }
    </style> -->
    <link rel="stylesheet" href="style.css">

</head>
<body>
    <h1>Event Form</h1>
    <form id="eventForm">
        <label for="title">Event Title:</label>
        <input type="text" id="title" required><br><br>

        <label for="date">Event Date:</label>
        <input type="date" id="date" required><br><br>

        <label for="time">Event Time:</label>
        <input type="time" id="time" required><br><br>

        <label for="location">Event Location:</label>
        <input type="text" id="location" required><br><br>

        <label for="description">Event Description:</label>
        <textarea id="description" required></textarea><br><br>

        <label for="tickets">Number of Tickets:</label>
        <input type="number" id="tickets" required><br><br>

        <label for="price">Ticket Price:</label>
        <input type="number" id="price" required step="0.01"><br><br>

        <button type="submit">Submit</button>
    </form>

    <h2>Event Cards</h2>
    <div id="cardsContainer"></div>

    <script>
        const apiKey = "AIzaSyCUkF0UxSM1vYwamXGJSEUYtMtRysAj4D4";
        const projectId = "bearcat-event-manager";
        const collectionName = "eventsCollection";

        const form = document.getElementById("eventForm");
        const cardsContainer = document.getElementById("cardsContainer");

        // Add a document to Firestore using the REST API
        async function addDocument(data) {
            const url = `https://firestore.googleapis.com/v1/projects/${projectId}/databases/(default)/documents/${collectionName}?key=${apiKey}`;
            const response = await fetch(url, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({
                    fields: {
                        title: { stringValue: data.title },
                        date: { stringValue: data.date },
                        time: { stringValue: data.time },
                        location: { stringValue: data.location },
                        description: { stringValue: data.description },
                        tickets: { integerValue: data.tickets },
                        price: { doubleValue: data.price }
                    }
                }),
            });

            if (response.ok) {
                console.log("Event added successfully");
                fetchAndDisplayCards(); // Refresh the displayed cards
            } else {
                console.error("Error adding event:", await response.text());
            }
        }

        // Fetch all documents from Firestore using the REST API
        async function fetchAndDisplayCards() {
            const url = `https://firestore.googleapis.com/v1/projects/${projectId}/databases/(default)/documents/${collectionName}?key=${apiKey}`;
            const response = await fetch(url);

            if (response.ok) {
                const data = await response.json();
                displayCards(data.documents || []);
            } else {
                console.error("Error fetching events:", await response.text());
            }
        }

        // Display events as cards
        function displayCards(documents) {
            cardsContainer.innerHTML = ""; // Clear existing cards
            documents.forEach((doc) => {
                const fields = doc.fields;
                const card = document.createElement("div");
                card.className = "card";
                card.innerHTML = `
                    <h3>${fields.title?.stringValue}</h3>
                    <p><strong>Date:</strong> ${fields.date?.stringValue}</p>
                    <p><strong>Time:</strong> ${fields.time?.stringValue}</p>
                    <p><strong>Location:</strong> ${fields.location?.stringValue}</p>
                    <p><strong>Description:</strong> ${fields.description?.stringValue}</p>
                    <p><strong>Tickets:</strong> ${fields.tickets?.integerValue}</p>
                    <p><strong>Price:</strong> $${fields.price?.doubleValue.toFixed(2)}</p>
                `;
                cardsContainer.appendChild(card);
            });
        }

        // Handle form submission
        form.addEventListener("submit", (e) => {
            e.preventDefault();
            const data = {
                title: document.getElementById("title").value,
                date: document.getElementById("date").value,
                time: document.getElementById("time").value,
                location: document.getElementById("location").value,
                description: document.getElementById("description").value,
                tickets: parseInt(document.getElementById("tickets").value, 10),
                price: parseFloat(document.getElementById("price").value),
            };

            addDocument(data); // Add the form data to Firestore
            form.reset(); // Reset the form
        });

        // Initial fetch to populate cards
        fetchAndDisplayCards();
    </script>
</body>
</html>
